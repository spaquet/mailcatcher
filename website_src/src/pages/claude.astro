---
import BaseLayout from '../layouts/BaseLayout.astro';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';

const title = 'Claude Integration - MailCatcher NG';
const description = 'Integrate MailCatcher NG with Claude for AI-powered email testing. Use Claude Plugin or MCP Server to manage emails with natural language.';
---

<BaseLayout title={title} description={description}>
  <Navigation activePage="claude" />

  <section class="bg-gradient-to-r from-primary to-primary-dark text-white px-5 py-16 text-center">
    <h1>Claude Integration</h1>
    <p>AI-powered email testing with Claude</p>
  </section>

  <section class="install-content">
    <div class="max-w-6xl mx-auto px-5">
        <div class="grid grid-cols-1 gap-12 max-w-2xl mx-auto">
            <!-- Overview -->
            <div class="border-l-4 border-primary pl-8">
                <h2>Overview</h2>
                <p>MailCatcher NG integrates seamlessly with Claude through two complementary methods:</p>
                <ul>
                    <li><strong>Claude Plugin</strong> - Use with Claude.com and Claude Desktop (easiest)</li>
                    <li><strong>MCP Server</strong> - Model Context Protocol for programmatic access</li>
                </ul>
                <p>Both methods expose the same 7 powerful tools for interacting with caught messages.</p>
            </div>

            <!-- Claude Plugin -->
            <div class="border-l-4 border-primary pl-8">
                <h2>Claude Plugin (Easiest)</h2>
                <p>Use MailCatcher NG with Claude.com or Claude Desktop without any additional configuration.</p>

                <h3>Step 1: Start MailCatcher with Plugin Mode</h3>
                <pre><code>mailcatcher --plugin --foreground</code></pre>

                <h3>Step 2: Add Plugin to Claude</h3>
                <p><strong>For Claude.com:</strong></p>
                <ul>
                    <li>Click the settings icon in Claude.com</li>
                    <li>Select "Plugins"</li>
                    <li>Click "Add Plugin"</li>
                    <li>Enter: <code>http://localhost:1080/.well-known/ai-plugin.json</code></li>
                    <li>Click "Add Plugin"</li>
                </ul>

                <p><strong>For Claude Desktop:</strong></p>
                <ul>
                    <li>Open Claude Desktop</li>
                    <li>Click Settings â†’ Plugins</li>
                    <li>Click "Add Plugin"</li>
                    <li>Enter: <code>http://localhost:1080/.well-known/ai-plugin.json</code></li>
                    <li>Click "Add Plugin"</li>
                </ul>

                <h3>Step 3: Start Using</h3>
                <p>Now ask Claude to help with your email testing!</p>
                <pre><code>Example prompts:

"What emails have I received today?"
"Find the latest password reset email"
"Extract the verification code from the confirmation email"
"Show me all emails from support@example.com"
"Delete the test emails"</code></pre>

                <h3>Plugin Advantages</h3>
                <ul>
                    <li>Works on Claude.com and Claude Desktop</li>
                    <li>Natural language interface</li>
                    <li>No configuration needed</li>
                    <li>Automatic authentication</li>
                </ul>
            </div>

            <!-- MCP Server -->
            <div class="border-l-4 border-primary pl-8">
                <h2>MCP Server (Programmatic)</h2>
                <p>Enable programmatic access via Model Context Protocol for Claude Desktop and other MCP-compatible clients.</p>

                <h3>Step 1: Start MailCatcher with MCP Mode</h3>
                <pre><code>mailcatcher --mcp --foreground</code></pre>

                <h3>Step 2: Configure Claude Desktop</h3>
                <p>Edit <code>~/.claude_desktop_config.json</code>:</p>
                <pre><code>&#123;
  "mcpServers": &#123;
    "mailcatcher": &#123;
      "command": "mailcatcher",
      "args": ["--mcp", "--foreground"]
    &#125;
  &#125;
&#125;</code></pre>

                <h3>Step 3: Restart Claude Desktop</h3>
                <p>Close and reopen Claude Desktop to load the MCP server.</p>

                <h3>MCP Advantages</h3>
                <ul>
                    <li>Direct tool access for Claude Desktop</li>
                    <li>Faster execution</li>
                    <li>Better for automation</li>
                    <li>Works with any MCP-compatible client</li>
                </ul>
            </div>

            <!-- Available Tools -->
            <div class="border-l-4 border-primary pl-8">
                <h2>Available Tools</h2>
                <p>Both Claude Plugin and MCP Server expose these 7 powerful tools:</p>

                <h3>1. search_messages</h3>
                <p>Full-text search with filtering.</p>
                <pre><code>Parameters:
  query (required)     - Search query text
  limit (optional)     - Number of results (default: 50)
  attachments (optional) - "only", "none", or "all"
  from_date (optional) - ISO 8601 date
  to_date (optional)   - ISO 8601 date

Example:
  search_messages(query="password reset", limit=10)</code></pre>

                <h3>2. get_latest_message_for</h3>
                <p>Find the latest message for a specific recipient.</p>
                <pre><code>Parameters:
  recipient (required) - Email address
  subject (optional)   - Filter by subject

Example:
  get_latest_message_for(recipient="user@example.com")</code></pre>

                <h3>3. extract_token_or_link</h3>
                <p>Extract OTPs, magic links, reset tokens from messages.</p>
                <pre><code>Parameters:
  message_id (required) - Message ID
  token_type (optional) - "otp", "link", "code", or "all"

Example:
  extract_token_or_link(message_id="1", token_type="otp")</code></pre>

                <h3>4. get_parsed_auth_info</h3>
                <p>Get structured authentication information (URLs, codes, tokens).</p>
                <pre><code>Parameters:
  message_id (required) - Message ID

Example:
  get_parsed_auth_info(message_id="1")</code></pre>

                <h3>5. get_message_preview_html</h3>
                <p>Get responsive HTML preview with mobile optimization.</p>
                <pre><code>Parameters:
  message_id (required) - Message ID
  mobile (optional)     - true for mobile view

Example:
  get_message_preview_html(message_id="1", mobile=true)</code></pre>

                <h3>6. delete_message</h3>
                <p>Delete a specific message.</p>
                <pre><code>Parameters:
  message_id (required) - Message ID

Example:
  delete_message(message_id="1")</code></pre>

                <h3>7. clear_messages</h3>
                <p>Delete all caught messages.</p>
                <pre><code>Example:
  clear_messages()</code></pre>
            </div>

            <!-- Use Cases -->
            <div class="border-l-4 border-primary pl-8">
                <h2>Common Use Cases</h2>

                <h3>Testing Authentication Flows</h3>
                <p>Verify confirmation emails and extract verification codes:</p>
                <pre><code>User: "Extract the verification code from the confirmation email"
Claude: Uses extract_token_or_link to find OTP codes</code></pre>

                <h3>Password Reset Testing</h3>
                <p>Find reset links automatically:</p>
                <pre><code>User: "Find the password reset link"
Claude: Searches for password reset emails and extracts links</code></pre>

                <h3>Email Debugging</h3>
                <p>Analyze email content and structure:</p>
                <pre><code>User: "Show me the latest welcome email in mobile view"
Claude: Retrieves message and renders mobile preview</code></pre>

                <h3>Testing Cleanup</h3>
                <p>Clean up test data:</p>
                <pre><code>User: "Delete all test emails from today"
Claude: Searches for test emails and deletes them</code></pre>

                <h3>Batch Operations</h3>
                <p>Perform multiple operations in sequence:</p>
                <pre><code>User: "Find all emails with attachments, show me the first one, then delete the rest"
Claude: Searches, displays, and deletes appropriately</code></pre>
            </div>

            <!-- Troubleshooting -->
            <div class="border-l-4 border-primary pl-8">
                <h2>Troubleshooting</h2>

                <h3>Plugin Won't Connect</h3>
                <p>Ensure MailCatcher is running with <code>--plugin --foreground</code> and the URL is correct:</p>
                <pre><code>http://localhost:1080/.well-known/ai-plugin.json</code></pre>
                <p>Check that port 1080 is accessible and not blocked by firewall.</p>

                <h3>MCP Server Not Loading</h3>
                <p>Verify the configuration in <code>~/.claude_desktop_config.json</code> is valid JSON:</p>
                <pre><code>cat ~/.claude_desktop_config.json | python -m json.tool</code></pre>
                <p>Restart Claude Desktop completely.</p>

                <h3>Tools Not Appearing</h3>
                <p>Try these steps in order:</p>
                <ul>
                    <li>Restart Claude Desktop</li>
                    <li>Check that MailCatcher is still running</li>
                    <li>Verify the plugin/MCP URL is correct</li>
                    <li>Check Claude's logs for error messages</li>
                </ul>

                <h3>Authentication Errors</h3>
                <p>If Claude can't access the plugin/MCP server:</p>
                <ul>
                    <li>Test the connection: <code>curl http://localhost:1080/.well-known/ai-plugin.json</code></li>
                    <li>Verify MailCatcher is running on the correct port</li>
                    <li>Check firewall/network settings</li>
                </ul>
            </div>

            <!-- Best Practices -->
            <div class="border-l-4 border-primary pl-8">
                <h2>Best Practices</h2>

                <h3>Use Claude Plugin for Interactive Testing</h3>
                <p>The Claude Plugin is best when you want to chat with Claude about your emails and test interactively.</p>

                <h3>Use MCP Server for Automation</h3>
                <p>The MCP Server is better for automated workflows and programmatic access in Claude Desktop.</p>

                <h3>Run MailCatcher in Foreground During Development</h3>
                <p>Use <code>--foreground</code> flag to see activity and debug more easily:</p>
                <pre><code>mailcatcher --plugin --foreground</code></pre>

                <h3>Keep MailCatcher Running</h3>
                <p>Leave MailCatcher running during development so Claude can always access messages.</p>

                <h3>Clear Old Messages Regularly</h3>
                <p>For long test sessions, periodically clear old messages to keep things organized:</p>
                <pre><code>User: "Clear all messages"
Claude: Calls clear_messages tool</code></pre>

                <h3>Use Specific Search Queries</h3>
                <p>For better results, use specific search terms:</p>
                <pre><code>Good: "Find the password reset email from today"
Less specific: "Find an email"</code></pre>
            </div>

            <!-- Related Documentation -->
            <div class="border-l-4 border-primary pl-8">
                <h2>Related Documentation</h2>
                <ul>
                    <li><a href="install.html">Installation Guide</a> - How to set up MailCatcher NG</li>
                    <li><a href="api.html">REST API Documentation</a> - Direct API access</li>
                    <li><a href="advanced.html">Advanced Usage</a> - SSL/TLS, persistence, and more</li>
                    <li><a href="https://github.com/spaquet/mailcatcher/tree/main/reference">Reference Documentation</a> - Detailed technical docs</li>
                </ul>
            </div>
        </div>
    </div>
</section>

  <Footer />
</BaseLayout>

<style>
  .page-header {
    background: linear-gradient(to right, var(--color-primary), var(--color-primary-dark));
    color: white;
    padding: 4rem 1.25rem;
    text-align: center;
  }

  .page-header h1 {
    color: white;
    margin-bottom: 0.5rem;
  }

  .page-header p {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.25rem;
  }

  .install-content {
    padding: 4rem 1.25rem;
  }
</style>
