---
import Layout from '../layouts/Layout.astro';
import CodeBlock from '../components/CodeBlock.astro';
---

<Layout title="Usage - MailCatcher NG" currentPage="usage">
  {/* Hero Section */}
  <section class="bg-forest-50 py-16 sm:py-24 border-b border-gray-200">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center space-y-4">
        <h1 class="font-display text-4xl sm:text-5xl lg:text-6xl font-bold text-anthracite">
          Usage Guide
        </h1>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          Comprehensive guide to running and configuring MailCatcher NG for email testing.
        </p>
      </div>
    </div>
  </section>

  {/* Content Section */}
  <section class="py-16 sm:py-24">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="prose prose-lg max-w-none">
        {/* Basic Usage */}
        <div class="mb-16">
          <h2 class="font-display text-3xl font-bold text-anthracite mb-6">Running MailCatcher NG</h2>

          <h3 class="font-display text-2xl font-semibold text-anthracite mb-4">Basic Usage</h3>
          <p class="text-gray-700 mb-6">
            Start MailCatcher with a single command:
          </p>
          <CodeBlock
            code="mailcatcher"
            language="bash"
            title="Basic command"
          />
          <p class="text-gray-700 mb-6">
            Then visit <a href="http://127.0.0.1:1080" class="text-forest-600 hover:underline">http://127.0.0.1:1080</a> and send mail to <code class="bg-gray-100 px-2 py-1 rounded">smtp://127.0.0.1:1025</code>.
          </p>
        </div>

        {/* Command Line Options */}
        <div class="mb-16">
          <h3 class="font-display text-2xl font-semibold text-anthracite mb-4">Command Line Options</h3>
          <p class="text-gray-700 mb-6">
            Use <code class="bg-gray-100 px-2 py-1 rounded">mailcatcher --help</code> to see all available options:
          </p>
          <CodeBlock
            code={`Usage: mailcatcher [options]

 MailCatcher NG v1.5.2

        --ip IP                        Set the ip address of both servers
        --smtp-ip IP                   Set the ip address of the smtp server
        --smtp-port PORT               Set the port of the smtp server
        --smtp-ssl                     Enable SSL/TLS support for SMTP
        --smtp-ssl-cert PATH           Path to SSL certificate file
        --smtp-ssl-key PATH            Path to SSL private key file
        --smtp-ssl-verify-peer         Verify client SSL certificates
        --smtps-port PORT              Set the port for direct TLS (default: 1465)
        --http-ip IP                   Set the ip address of the http server
        --http-port PORT               Set the port address of the http server
        --messages-limit COUNT         Only keep up to COUNT most recent messages
        --persistence                  Store messages in a persistent SQLite database file
        --http-path PATH               Add a prefix to all HTTP paths
        --forward-smtp-host HOST       SMTP server for forwarding messages
        --forward-smtp-port PORT       SMTP port for forwarding messages
        --forward-smtp-user USER       SMTP username for forwarding messages
        --forward-smtp-password PASS   SMTP password for forwarding messages
        --[no-]forward-smtp-tls        Enable/disable TLS for forwarding SMTP (default: enabled)
        --mcp                          Enable MCP server for Claude integration
        --plugin                       Enable Claude Plugin endpoints
        --no-quit                      Don't allow quitting the process
    -f, --foreground                   Run in the foreground
    -b, --browse                       Open web browser
    -v, --verbose                      Be more verbose
    -h, --help                         Display this help information
        --version                      Display the current version`}
            language="bash"
            title="Available options"
          />
        </div>

        {/* Message Forwarding */}
        <div class="mb-16">
          <h3 class="font-display text-2xl font-semibold text-anthracite mb-4">Message Forwarding</h3>
          <p class="text-gray-700 mb-6">
            Forward caught email messages to real SMTP servers for validation before production deployment:
          </p>
          <CodeBlock
            code={`mailcatcher \\
  --forward-smtp-host smtp.example.com \\
  --forward-smtp-port 587 \\
  --forward-smtp-user your-username@example.com \\
  --forward-smtp-password your-password`}
            language="bash"
            title="Message forwarding setup"
          />
          <p class="text-gray-700">
            Then use the <code class="bg-gray-100 px-2 py-1 rounded">/messages/:id/forward</code> API endpoint to forward specific messages. See <a href="/api/" class="text-forest-600 hover:underline">API documentation</a> for details.
          </p>
        </div>

        {/* Claude Integration */}
        <div class="mb-16">
          <h3 class="font-display text-2xl font-semibold text-anthracite mb-4">Claude Integration</h3>

          <h4 class="font-display text-xl font-semibold text-anthracite mb-4">Claude Plugin</h4>
          <p class="text-gray-700 mb-6">
            Enable the Claude Plugin for use in Claude.com or Claude Desktop:
          </p>
          <CodeBlock
            code="mailcatcher --plugin --foreground"
            language="bash"
            title="Enable Claude Plugin"
          />
          <p class="text-gray-700 mb-6">
            Then add the plugin in Claude:
          </p>
          <ol class="list-decimal list-inside text-gray-700 mb-6 space-y-2">
            <li>Go to Claude settings/plugins</li>
            <li>Click "Create a plugin"</li>
            <li>Enter: <code class="bg-gray-100 px-2 py-1 rounded">http://localhost:1080/.well-known/ai-plugin.json</code></li>
            <li>Click Install</li>
          </ol>
          <p class="text-gray-700 mb-6">
            Claude now has access to email search, token extraction, and message management tools.
          </p>

          <h4 class="font-display text-xl font-semibold text-anthracite mb-4">MCP Server</h4>
          <p class="text-gray-700 mb-6">
            Enable the MCP (Model Context Protocol) server for programmatic access:
          </p>
          <CodeBlock
            code="mailcatcher --mcp --foreground"
            language="bash"
            title="Enable MCP Server"
          />
          <p class="text-gray-700 mb-6">
            Configure Claude Desktop by editing <code class="bg-gray-100 px-2 py-1 rounded">~/.claude_desktop_config.json</code>:
          </p>
          <CodeBlock
            code={`{
  "mcpServers": {
    "mailcatcher": {
      "command": "mailcatcher",
      "args": ["--mcp", "--foreground"]
    }
  }
}`}
            language="json"
            title="Claude Desktop configuration"
          />
          <p class="text-gray-700 mb-6">
            Then restart Claude Desktop to enable MCP tools.
          </p>

          <h4 class="font-display text-xl font-semibold text-anthracite mb-4">Both Plugin and MCP</h4>
          <p class="text-gray-700 mb-6">
            For maximum flexibility, enable both:
          </p>
          <CodeBlock
            code="mailcatcher --mcp --plugin --foreground"
            language="bash"
            title="Enable both Plugin and MCP"
          />
          <p class="text-gray-700">
            For complete setup guide, see <a href="/ai-integration/" class="text-forest-600 hover:underline">Claude Integration Guide</a>.
          </p>
        </div>

        {/* Development Mode */}
        <div class="mb-16">
          <h3 class="font-display text-2xl font-semibold text-anthracite mb-4">Development Mode</h3>
          <p class="text-gray-700 mb-6">
            Run MailCatcher NG in development mode with custom ports:
          </p>
          <CodeBlock
            code="MAILCATCHER_ENV=development bundle exec mailcatcher --foreground --smtp-port 1025 --http-port 1080"
            language="bash"
            title="Development mode setup"
          />
          <p class="text-gray-700 mb-6">
            Then access the web interface at <a href="http://127.0.0.1:1080" class="text-forest-600 hover:underline">http://127.0.0.1:1080</a> and send mail to <code class="bg-gray-100 px-2 py-1 rounded">smtp://127.0.0.1:1025</code>.
          </p>

          <h4 class="font-display text-xl font-semibold text-anthracite mb-4">Sending Example Emails</h4>
          <p class="text-gray-700 mb-6">
            Use the provided test script to send example emails:
          </p>
          <CodeBlock
            code="SMTP_HOST=127.0.0.1 SMTP_PORT=20025 ruby send_example_emails.rb"
            language="bash"
            title="Send example emails"
          />
        </div>

        {/* Web Interface */}
        <div class="mb-16">
          <h3 class="font-display text-2xl font-semibold text-anthracite mb-4">Web Interface</h3>

          <h4 class="font-display text-xl font-semibold text-anthracite mb-4">Features</h4>
          <ul class="list-disc list-inside text-gray-700 mb-6 space-y-2">
            <li>View HTML, plain text, and source versions of messages</li>
            <li>Download original email to view in your native mail client</li>
            <li>List attachments and download individual parts</li>
            <li>HTML rewriting for embedded images and safe link opening</li>
          </ul>

          <h4 class="font-display text-xl font-semibold text-anthracite mb-4">Real-time Updates</h4>
          <p class="text-gray-700 mb-6">
            Mail appears instantly if your browser supports <a href="https://tools.ietf.org/html/rfc6455" class="text-forest-600 hover:underline">WebSockets</a> with automatic reconnection and exponential backoff. Otherwise, updates refresh every thirty seconds.
          </p>

          <h4 class="font-display text-xl font-semibold text-anthracite mb-4">WebSocket Testing</h4>
          <p class="text-gray-700 mb-6">
            To monitor WebSocket connectivity and test the connection status, visit <a href="http://127.0.0.1:1080/websocket-test" class="text-forest-600 hover:underline">http://127.0.0.1:1080/websocket-test</a>. This page provides real-time feedback on WebSocket connection state and helps verify that automatic reconnection with exponential backoff is functioning correctly.
          </p>

          <h4 class="font-display text-xl font-semibold text-anthracite mb-4">Keyboard Navigation</h4>
          <p class="text-gray-700 mb-6">
            Use keyboard shortcuts to navigate between messages in the web interface.
          </p>
        </div>

        {/* Background Operation */}
        <div class="mb-16">
          <h3 class="font-display text-2xl font-semibold text-anthracite mb-4">Background Operation</h3>
          <p class="text-gray-700 mb-6">
            MailCatcher NG runs as a daemon in the background by default. To run in the foreground instead:
          </p>
          <CodeBlock
            code="mailcatcher --foreground"
            language="bash"
            title="Foreground mode"
          />

          <h4 class="font-display text-xl font-semibold text-anthracite mb-4">Browser Integration</h4>
          <p class="text-gray-700">
            Open your default web browser automatically on startup:
          </p>
          <CodeBlock
            code="mailcatcher --browse"
            language="bash"
            title="Auto-open browser"
          />
        </div>

        {/* Limiting Messages */}
        <div class="mb-16">
          <h3 class="font-display text-2xl font-semibold text-anthracite mb-4">Limiting Messages</h3>
          <p class="text-gray-700 mb-6">
            To prevent excessive memory usage, limit the number of messages stored:
          </p>
          <CodeBlock
            code="mailcatcher --messages-limit 100"
            language="bash"
            title="Limit to 100 messages"
          />
          <p class="text-gray-700">
            Only the 100 most recent messages will be kept.
          </p>
        </div>

        {/* Persistent Storage */}
        <div class="mb-16">
          <h3 class="font-display text-2xl font-semibold text-anthracite mb-4">Persistent Storage</h3>
          <p class="text-gray-700 mb-6">
            By default, MailCatcher NG stores messages in memory and they are lost when the process terminates. To keep messages across restarts, enable persistent storage:
          </p>
          <CodeBlock
            code="mailcatcher --persistence"
            language="bash"
            title="Enable persistent storage"
          />
          <p class="text-gray-700 mb-6">
            Messages will be stored in a SQLite database file at <code class="bg-gray-100 px-2 py-1 rounded">~/.mailcatcher/mailcatcher.db</code>. The directory is automatically created if it doesn't exist.
          </p>

          <p class="text-gray-700">
            You can combine persistence with other options:
          </p>
          <CodeBlock
            code="mailcatcher --persistence --messages-limit 500"
            language="bash"
            title="Persistence with message limit"
          />
        </div>

        {/* Custom HTTP Path */}
        <div class="mb-16">
          <h3 class="font-display text-2xl font-semibold text-anthracite mb-4">Custom HTTP Path</h3>
          <p class="text-gray-700 mb-6">
            Add a prefix to all HTTP paths (useful when running behind a reverse proxy):
          </p>
          <CodeBlock
            code="mailcatcher --http-path /mailcatcher"
            language="bash"
            title="Custom HTTP path"
          />
          <p class="text-gray-700">
            Access the web interface at <code class="bg-gray-100 px-2 py-1 rounded">http://127.0.0.1:1080/mailcatcher/</code>
          </p>
        </div>
      </div>
    </div>
  </section>

  {/* CTA Section */}
  <section class="py-16 sm:py-24 bg-forest-50 border-t border-gray-200">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center space-y-6">
        <h2 class="font-display text-3xl sm:text-4xl font-bold text-anthracite">Need help?</h2>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          Check out the API documentation, Claude integration guide, or advanced documentation for more information.
        </p>
        <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
          <a href="/api/" class="btn-primary">
            API Documentation
          </a>
          <a href="/ai-integration/" class="btn-secondary">
            Claude Integration
          </a>
          <a href="/advanced/" class="btn-secondary">
            Advanced Guide
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>
